<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lyenliang.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Brian&#39;s Blog">
<meta property="og:url" content="https://lyenliang.github.io/index.html">
<meta property="og:site_name" content="Brian&#39;s Blog">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Brian&#39;s Blog">

<link rel="canonical" href="https://lyenliang.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-TW'
  };
</script>

  <title>Brian's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Brian's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2023/03/12/使用-pipreqs-快速-requirements-txt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/12/使用-pipreqs-快速-requirements-txt/" class="post-title-link" itemprop="url">使用 pipreqs 快速產生 python 套件紀錄檔 (requirements.txt)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2023-03-12 20:39:51" itemprop="dateCreated datePublished" datetime="2023-03-12T20:39:51+08:00">2023-03-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2023-03-13 09:41:50" itemprop="dateModified" datetime="2023-03-13T09:41:50+08:00">2023-03-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在使用 Python 開發專案時，有時需要許多第三方套件來更快速地完成開發工作。</p>
<p>這些套件可能會有各種不同的版本，而在不同的機器上可能會有不同的套件版本安裝。為了確保在不同機器上的程式運作一致，我們需要一份清單來確保所有的套件都是相同的版本。這時候就需要 requirements.txt 這個檔案來記錄第三方套件與對應的版本。</p>
<p><a href="https://pypi.org/project/pipreqs/" target="_blank" rel="noopener">pipreqs</a> 則是一個非常方便的工具，可以幫助我們自動產生 requirements.txt。</p>
<h3 id="什麼是-requirements-txt？"><a href="#什麼是-requirements-txt？" class="headerlink" title="什麼是 requirements.txt？"></a>什麼是 requirements.txt？</h3><p>在開發 Python 專案時，我們會使用許多 Python 套件來協助我們完成任務。當我們需要分享這個專案給其他人時，他們需要安裝相同的套件才能夠運行程式。使用 requirements.txt，我們可以輕鬆地將專案所需的套件清單分享給其他人，讓他們可以快速且方便地安裝所需的套件。此外，requirements.txt 也可以用來管理專案所需的套件版本，以確保專案的穩定性和一致性。</p>
<h3 id="用-pipreqs-與-pip-freeze-產生-requirements-txt-的差異"><a href="#用-pipreqs-與-pip-freeze-產生-requirements-txt-的差異" class="headerlink" title="用 pipreqs 與 pip freeze 產生 requirements.txt 的差異"></a>用 pipreqs 與 pip freeze 產生 requirements.txt 的差異</h3><p>在產生 requirements.txt 時，我們可以使用 <code>pip freeze &gt; requirements.txt</code> 指令產生。這個指令可以讓我們輕鬆地產生一個包含專案所需套件清單的文字檔。不過這個指會將環境中所有套件都列出來，包含基本且不需要額外手動安裝的套件。</p>
<p>而 pipreqs 是一個更加方便的工具。pipreqs 可以自動掃描專案所需的套件並產生 requirements.txt。此外，pipreqs 可以排除不必要的套件，只列出專案所需的套件清單，讓 requirements.txt 更加精簡。當我們新增或刪除套件時，只需要重新執行 pipreqs 即可更新 requirements.txt，方便快速。</p>
<h3 id="pipreqs-的安裝與使用方式"><a href="#pipreqs-的安裝與使用方式" class="headerlink" title="pipreqs 的安裝與使用方式"></a>pipreqs 的安裝與使用方式</h3><p>我們可以使用底下的指令安裝 pipreqs：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pipreqs</span><br></pre></td></tr></table></figure></p>
<p>安裝完成後，我們可以進入專案的根目錄，並執行以下指令來產生 requirements.txt：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipreqs .</span><br></pre></td></tr></table></figure>
<p>其中的「.」代表專案的根目錄。這個指令會自動掃描專案所需的套件並產生 requirements.txt 檔案。預設情況下，requirements.txt 檔案會儲存在專案的根目錄下。如果要儲存到不同的目錄下，可以加上 -p 或 –savepath 參數，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipreqs . --savepath /path/to/requirements.txt</span><br></pre></td></tr></table></figure>
<p>整體來說，pipreqs 是一個非常方便快速的工具，可以自動掃描專案所需的套件並產生 requirements.txt 檔案，讓專案的套件管理更加便利。如果你正在開發 Python 專案，不妨試試使用 pipreqs 來產生 requirements.txt 檔案吧！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2022/05/06/Pytest-Fixture-介紹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/06/Pytest-Fixture-介紹/" class="post-title-link" itemprop="url">Pytest Fixture 介紹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2022-05-06 23:06:08" itemprop="dateCreated datePublished" datetime="2022-05-06T23:06:08+08:00">2022-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在用 pytest 寫測試時，可能有些程式碼每個測試一開始都需要執行，像是建立資料庫連線：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import mysql.connector</span><br><span class="line"></span><br><span class="line">def test_read_db():</span><br><span class="line">    # mydb 在兩個 test 裡都有出現</span><br><span class="line">    mydb = mysql.connector.connect(</span><br><span class="line">        host=&quot;localhost&quot;,</span><br><span class="line">        user=&quot;yourusername&quot;,</span><br><span class="line">        password=&quot;yourpassword&quot;</span><br><span class="line">    )</span><br><span class="line">    mycursor = mydb.cursor()</span><br><span class="line">    mycursor.execute(&quot;SELECT * FROM customers WHERE name = &apos;Andy&apos;&quot;)</span><br><span class="line">    rows = mycursor.fetchall()</span><br><span class="line">    assert len(rows) == 1</span><br><span class="line"></span><br><span class="line">def test_update_db():</span><br><span class="line">    # mydb 在兩個 test 裡都有出現</span><br><span class="line">    mydb = mysql.connector.connect(</span><br><span class="line">        host=&quot;localhost&quot;,</span><br><span class="line">        user=&quot;yourusername&quot;,</span><br><span class="line">        password=&quot;yourpassword&quot;</span><br><span class="line">    )</span><br><span class="line">    mycursor = mydb.cursor()</span><br><span class="line">    sql = &quot;UPDATE customers SET address = &apos;Canyon 123&apos; WHERE address = &apos;Valley 345&apos;&quot;</span><br><span class="line">    mycursor.execute(sql)</span><br><span class="line">    mydb.commit()</span><br><span class="line">    assert mycursor.rowcount == 1</span><br></pre></td></tr></table></figure>
<p>這些重複的程式碼如果只需要寫一次的話，想必可以讓你的 code 讀起來較輕鬆，日後維護也比較方便。</p>
<p>這時可以考慮用 pytest 的 fixture 功能來避免程式碼重複。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">import mysql.connector</span><br><span class="line"></span><br><span class="line">@pytest.fixture</span><br><span class="line">def mydb():</span><br><span class="line">    return mysql.connector.connect(</span><br><span class="line">        host=&quot;localhost&quot;,</span><br><span class="line">        user=&quot;yourusername&quot;,</span><br><span class="line">        password=&quot;yourpassword&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">def test_read_db(mydb):</span><br><span class="line">    mycursor = mydb.cursor()</span><br><span class="line">    mycursor.execute(&quot;SELECT * FROM customers WHERE name = &apos;Andy&apos;&quot;)</span><br><span class="line">    rows = mycursor.fetchall()</span><br><span class="line">    assert len(rows) == 1</span><br><span class="line"></span><br><span class="line">def test_update_db(mydb):</span><br><span class="line">    mycursor = mydb.cursor()</span><br><span class="line">    sql = &quot;UPDATE customers SET address = &apos;Canyon 123&apos; WHERE address = &apos;Valley 345&apos;&quot;</span><br><span class="line">    mycursor.execute(sql)</span><br><span class="line">    mydb.commit()</span><br><span class="line">    assert mycursor.rowcount == 1</span><br></pre></td></tr></table></figure>
<p>在上面的 code 裡，你可以發現我把原本的 <code>mydb</code> 轉成以下程式碼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@pytest.fixture</span><br><span class="line">def mydb():</span><br><span class="line">    return mysql.connector.connect(</span><br><span class="line">        host=&quot;localhost&quot;,</span><br><span class="line">        user=&quot;yourusername&quot;,</span><br><span class="line">        password=&quot;yourpassword&quot;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>然後將 <code>mydb</code> 當作參數傳給 test function，這樣 test function 還是可以使用 <code>mydb</code>，且 <code>mydb</code> 只要建立一次就可以。</p>
<p>不過由於 MySQL 建立連線需要一段時間，如果每跑一個測試就重建一次連線的話，非常耗時。為了節省時間，我們可以設定 fixture 在所有測試開始前，只執行一次：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@pytest.fixture(scope=&quot;module&quot;)</span><br><span class="line">def mydb():</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
<p>fixture 有 scope 參數可設定，當設為 <code>&quot;module&quot;</code> 時，fixture 會在 module 內最後一個 test 執行完才被拆掉。</p>
<p>詳細的 fixture scope 參數可以查看<a href="https://docs.pytest.org/en/6.2.x/fixture.html#fixture-scopes" target="_blank" rel="noopener">這篇文章</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2021/05/19/bash-腳本也能用-try-catch！/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/19/bash-腳本也能用-try-catch！/" class="post-title-link" itemprop="url">在 Bash 腳本實現 try catch！</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2021-05-19 22:19:00" itemprop="dateCreated datePublished" datetime="2021-05-19T22:19:00+08:00">2021-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://www.eztrust.com.tw/webdesign/C/111#:~:text=try%2Dcatch%20%E5%8D%80%E5%A1%8A%E7%9A%84,%E6%89%80%E7%94%A2%E7%94%9F%E7%9A%84%E4%BE%8B%E5%A4%96%E7%8B%80%E6%B3%81%E3%80%82&amp;text=%E6%93%B2%E5%9B%9E%E4%BE%8B%E5%A4%96%E7%8B%80%E6%B3%81%E4%B9%8B%E5%BE%8C,%E8%83%BD%E6%94%94%E6%88%AA%E8%A9%B2%E4%BE%8B%E5%A4%96%E7%8B%80%E6%B3%81%E3%80%82" target="_blank" rel="noopener">try catch</a> 是 java 用來補捉例外狀況的語法，bash 腳本本身並不支援這種語法，但是我們可以透過特殊的方法來達到同樣的目的。</p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; # try</span><br><span class="line"></span><br><span class="line">    command1 &amp;&amp;</span><br><span class="line">    command2 &amp;&amp;</span><br><span class="line">    command3</span><br><span class="line"></span><br><span class="line">&#125; || &#123; # catch</span><br><span class="line">    # save log for exception </span><br><span class="line">    echo 執行異常</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的範例當中，當 <code>command1</code>, <code>command2</code> 發生錯誤時，後續的指令都不會執行，並會直接跳到 <code>echo 執行異常</code> 這一行。</p>
<p>而且當 <code>command1</code>, <code>command2</code>, <code>command3</code> 都順利執行後，<code>echo 執行異常</code> 並不會被觸發。</p>
<p>程式會這樣運作是因為 or 運算元（<code>||</code>）會判斷第一個括號（<code>{...}</code>）內回傳的值是不是 True，若是 True 的話，第二個括號內的指令就不會執行。</p>
<p>指令順利執行完並結束可以視為 True，所以第一個括號內的三個指令才需要用 and 運算元（<code>&amp;&amp;</code>）串接在一起，因為 True AND True AND True == True。</p>
<p>如果把 <code>&amp;&amp;</code> 刪掉的話，<code>command1</code>, <code>command2</code>, <code>command3</code> 都會執行，且如果 <code>command3</code> 執行異常的話，<code>echo 執行異常</code> 也會被觸發。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2021/01/19/Python-virtualenv-介紹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/19/Python-virtualenv-介紹/" class="post-title-link" itemprop="url">Python virtualenv 介紹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2021-01-19 21:37:00" itemprop="dateCreated datePublished" datetime="2021-01-19T21:37:00+08:00">2021-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h4><p>有時候我們在用 python 開發專案時，可能 A 專案需要 C 模組的 1.0 版，B 專案要 C 模組的 2.0 版，如果你要在 A、B 專案之間切換就會非常不方便。</p>
<p>當然你可以在開發 A 專案時，把 C 模組 2.0 版刪掉，然後改裝 1.0 版，等要處理 B 專案時，再把 C 模組升級到 2.0 版，不過這樣操作太過麻煩。</p>
<p><a href="https://virtualenv.pypa.io/en/latest/" target="_blank" rel="noopener">virtualenv</a> 的誕生就是為了解決這個問題。</p>
<h4 id="安裝方式"><a href="#安裝方式" class="headerlink" title="安裝方式"></a>安裝方式</h4><p>virtualenv 可透過 <code>pip</code> 安裝，輸入 <code>pip install virtualenv</code> 就能安裝，其它安裝方法可參考 <a href="https://virtualenv.pypa.io/en/latest/installation.html" target="_blank" rel="noopener">virtualenv installation</a>。</p>
<h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><p>首先切換到打算建立 python 環境的目錄，並輸入 <code>virtualenv &lt;env_name&gt;</code>，例如我想建名叫 <code>myenv</code> 的 python 環境，我可以輸入 <code>virtualenv myenv</code>，輸入完就會產生 <code>myenv/</code> 資料夾，這時可以用 <code>source myenv/bin/activate</code> 來啟動環境。</p>
<p>啟動後你可以用 <a href="https://pip.pypa.io/en/stable/reference/pip_freeze/" target="_blank" rel="noopener"><code>pip freeze</code></a> 來確認是不是真的沒有任何已裝好的 python 模組，因為全新的環境不應該有任何已安裝的模組。</p>
<p>這時你就可以將要安裝的套件寫到 <code>requirements.txt</code> 檔案裡，然後用 <code>pip install -r requirements.txt</code> 安裝。</p>
<p><code>requirements.txt</code> 內容長的像這樣：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boto3==1.9.253</span><br><span class="line">pandas==1.0.3</span><br><span class="line">requests==2.22.0</span><br><span class="line">PyYAML==3.13</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2019/10/01/WS-Lambda-Function-Layer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/01/WS-Lambda-Function-Layer/" class="post-title-link" itemprop="url">AWS Lambda Layer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-10-01 18:03:00" itemprop="dateCreated datePublished" datetime="2019-10-01T18:03:00+08:00">2019-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="問題介紹"><a href="#問題介紹" class="headerlink" title="問題介紹"></a>問題介紹</h4><p><a href="https://aws.amazon.com/tw/lambda/" target="_blank" rel="noopener">AWS Lambda</a> 是一套 Serveless 服務，讓使用者不必花太多時間佈建或管理伺服器，同時得到更多時間編寫核心邏輯。</p>
<p>不過 AWS Lambda 也有些小缺點，例如當 code 與用到的 libraries <a href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html#limits-list" target="_blank" rel="noopener">超過 3MB</a> 時，你會被告知 deployment package too large</p>
<p><img src="/images/pasted-2.png" alt="upload successful"></p>
<p>雖然這不影響 function 的運行，但會讓人不方便編輯與查看 lambda function 內容。</p>
<h4 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h4><p>為了解決這項問題，AWS 在 <a href="https://aws.amazon.com/tw/blogs/aws/new-for-aws-lambda-use-any-programming-language-and-share-common-components/" target="_blank" rel="noopener">2018 年推出 Lambda Layers</a> 來存放 function 之間共用的 libraries。</p>
<h4 id="實際舉例"><a href="#實際舉例" class="headerlink" title="實際舉例"></a>實際舉例</h4><p>以下拿 python3 的 Lambda Function 當例子:</p>
<p>假設有個 python 程式需要 <code>PyMySQL</code>、<code>PyYAML</code>、<code>openpyxl</code> 三個 Libraries。</p>
<h5 id="使用-Layer-前"><a href="#使用-Layer-前" class="headerlink" title="使用 Layer 前"></a>使用 Layer 前</h5><p>在不使用 layer 的情況下，你需要建立一個 <code>requirements.txt</code>，並在裡面寫上 Libraries 與對應的版本。</p>
<p><img src="/images/pasted-3.png" alt="upload successful"></p>
<p>然後用 <code>pip install --requirement requirements.txt</code> 安裝 Libraries。裝好後你會發現資料夾裡多了好多不是自己寫的檔案:</p>
<p><img src="/images/pasted-5.png" alt="upload successful"></p>
<p>由於這些 libraries 跟你寫的 code 在同一個資料夾層級，它們會阻礙你閱讀 code，而且它們超過 3MB，無法在 AWS Lambda 線上編輯器顯示。</p>
<h5 id="使用-Layer-後"><a href="#使用-Layer-後" class="headerlink" title="使用 Layer 後"></a>使用 Layer 後</h5><p>當你打算採用 layer 時，你需要將 Libraries 打包到名為 <code>python</code> 的資料夾內</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install \</span><br><span class="line">  --requirement requirements.txt \</span><br><span class="line">  --target python</span><br></pre></td></tr></table></figure>
<p>然後用 <code>zip -r lambdaLayer.zip python</code> 將它打包再上傳。</p>
<p>以下介紹透過 AWS Console 上傳的方式</p>
<p>首先進入 AWS Lambda Function Layers 頁面，並點選 <code>Create Layer</code></p>
<p><img src="/images/pasted-8.png" alt="upload successful"></p>
<p>上傳剛剛打包好的 zip 檔</p>
<p><img src="/images/pasted-9.png" alt="upload successful"></p>
<p>上傳好你會得到一串資源識別碼 (ARN, Amazon Resource Name)，記下它，因為等一下會用到</p>
<p><img src="/images/pasted-10.png" alt="upload successful"></p>
<p>這時再回到你想加入 Layer 的 lambda function，然後點選 <code>Layers</code>。注意 Layers 右邊有個 <code>(0)</code>，它表示現在有的 Layer 數是 0。</p>
<p><img src="/images/pasted-11.png" alt="upload successful"></p>
<p>然後再點選 <code>Add a layer</code></p>
<p><img src="/images/pasted-12.png" alt="upload successful"></p>
<p>再來選 <code>Provide a layer version ARN</code>，並貼上剛剛記下的 ARN</p>
<p><img src="/images/pasted-13.png" alt="upload successful"></p>
<p>這時 Layer 只快建立完成，最後只要按下 <code>Save</code> 就能儲存 Layer，注意這時 <code>Layers</code> 右邊的數字變成 1，表示有一個 Layer。</p>
<p><img src="/images/pasted-14.png" alt="upload successful"></p>
<h4 id="結果比較"><a href="#結果比較" class="headerlink" title="結果比較"></a>結果比較</h4><p>從上面的例子可以發現使用 Layer 後，編輯器裡只會留下你自己編寫的檔案</p>
<p><img src="/images/pasted-17.png" alt="uploaded!"></p>
<p>這樣不僅方便看 code，也可以在 AWS Lambda 線上編輯器直接修改 code 。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2019/09/18/手機也能撥免付費電話！/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/18/手機也能撥免付費電話！/" class="post-title-link" itemprop="url">手機也能撥免付費電話！</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-09-18 22:34:00" itemprop="dateCreated datePublished" datetime="2019-09-18T22:34:00+08:00">2019-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>0800 開頭的電話是<a href="https://www.cht.com.tw/home/enterprise/local/bonus/enterprise-valueadded/0800-receive-pay" target="_blank" rel="noopener">受話方付費</a>。假設你打電話給信用卡公司的 0800 專線，信用卡公司就要付錢給電信業者。</p>
<p>手機由於通話費用較高的關係，有些公司會設定只能透過市話撥打 0800 專線，手機必須撥打另外設立的市內電話，並自行負擔費用。</p>
<p>幸好手機可以改用 <a href="https://play.google.com/store/apps/details?id=com.skype.raider&amp;hl=en" target="_blank" rel="noopener">Skype</a> 撥打 0800 免付費電話，不用買月租，不必儲值。記得用的時候手機必須連上網路，不管是 4G 或 Wifi 上網都可以。</p>
<p>#省錢 #小資 #免費</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2019/09/10/nohup-程式執行從此不中斷/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/10/nohup-程式執行從此不中斷/" class="post-title-link" itemprop="url">nohup - 程式執行從此不中斷</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-09-10 21:29:19" itemprop="dateCreated datePublished" datetime="2019-09-10T21:29:19+08:00">2019-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>對於遠端 ssh 登入 Linux 的使用者來說，若遇到程式需要跑很久的情況（例如 <code>scp</code> 傳輸大檔案），通常只能乖乖等它執行完，若跑到一半不幸連線中斷，程式只能重跑一次，造成大量的時間被浪費。</p>
<p>幸好 Linux 有提供 <a href="https://en.wikipedia.org/wiki/Nohup" target="_blank" rel="noopener"><code>nohup</code></a> 指令讓我們可以在 ssh 連線登出後，程式照樣能繼續執行。</p>
<p>一般 Linux 使用者登出後，他執行的所有程式都會收到 <a href="https://en.wikipedia.org/wiki/SIGHUP" target="_blank" rel="noopener">SIGHUP</a> （SIGnup Hang UP）訊號，正常程式收到 SIGHUP 就會立刻停止執行。</p>
<p><code>nohup</code> （字面意思 No Hang Up）可以讓程式忽略 <code>SIGHUP</code>，所以當使用者斷線或登出時，程式可以繼續執行，不會受到影響。</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>假設原本你想用 <code>scp /path/to/my/file brian@123.123.123.123:/home/brian</code> 將一個大檔案複製到遠端機器，你可以將指令改成 <code>nohup scp /path/to/my/file brian@123.123.123.123:/home/brian &amp;</code> 來執行，指令尾端的 <code>&amp;</code> 代表<code>nohup</code> 會在背景，避免卡住你現在執行的 ssh 視窗。</p>
<h2 id="觀察輸出結果"><a href="#觀察輸出結果" class="headerlink" title="觀察輸出結果"></a>觀察輸出結果</h2><p>既然有程式在執行，那麼你一定會想看執行的結果。 <code>nohup</code> 預設會將所有的輸出資訊寫到 <code>nohup.txt</code> 這個檔案，你可以用 <code>cat nohup.txt</code> 查看程式輸出資訊，或是用 <code>tail -f nohup.txt</code> 即時查看最後輸出的幾筆資料。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2018/08/24/Python-Datetime-Manipulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/24/Python-Datetime-Manipulation/" class="post-title-link" itemprop="url">Python Datetime Conversion</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2018-08-24 16:29:00" itemprop="dateCreated datePublished" datetime="2018-08-24T16:29:00+08:00">2018-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>One of the common issues we face when developing a software is dealing with dates and times. For example, after getting a date-time string from an API, we might have to convert it to another format that is easier for humans to read. If the API executes in different places around the world, we will need to take timezone into consideration.</p>
<p>Here, I summarize some of the frequently used functions when handling python <code>datetime</code>.</p>
<p><img src="/images/python/python_datetime.png" alt="Python datetime conversion" style="width: 630px; "></p>
<p>Let’s first talk about the conversion between string and datetime:</p>
<h3 id="Converting-string-to-datetime"><a href="#Converting-string-to-datetime" class="headerlink" title="Converting string to datetime"></a>Converting <code>string</code> to <code>datetime</code></h3><p>Use <code>strptime()</code> if your want to convert a string to datetime:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line"></span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">format = &apos;%Y-%m-%d %H:%M:%S %z&apos;</span><br><span class="line"># the string variable</span><br><span class="line">datetime_str = &apos;2018-05-13 12:34:56 +0800&apos;</span><br><span class="line"># the `datetime` variable</span><br><span class="line">datetime_dt = datetime.strptime(datetime_str, format)</span><br><span class="line"></span><br><span class="line">print(type(datetime_dt))  # &lt;class &apos;datetime.datetime&apos;&gt;</span><br><span class="line">print(datetime_dt)        # 2018-05-13 12:34:56+08:00</span><br></pre></td></tr></table></figure></p>
<p>The meaning of the format codes can be found at <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior" target="_blank" rel="noopener">Python’s documentation</a>.</p>
<h3 id="Converting-datetime-to-string"><a href="#Converting-datetime-to-string" class="headerlink" title="Converting datetime to string"></a>Converting <code>datetime</code> to <code>string</code></h3><p>Use <code>strftime()</code> if your want to convert a datetime to string:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line"></span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">datetime_dt = datetime.now()  # 2018-08-24 18:00:25.855212</span><br><span class="line">datetime_str = datetime_dt.strftime(&apos;%Y-%m-%d %H:%M:%S %z&apos;)</span><br><span class="line"></span><br><span class="line">print(type(datetime_str)) # &lt;class &apos;str&apos;&gt;</span><br><span class="line">print(datetime_str)       # 2018-08-24 18:00:25</span><br></pre></td></tr></table></figure>
<h3 id="Changing-timezone"><a href="#Changing-timezone" class="headerlink" title="Changing timezone:"></a>Changing timezone:</h3><p><code>astimezone()</code> can be used to change the timezone of a datetime variable:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line"></span><br><span class="line">import pytz</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line"># My PC is located in UTC+8 timezone</span><br><span class="line">datetime_dt = datetime.now()    # 2018-08-24 21:35:46.694889 </span><br><span class="line">print(datetime_dt)</span><br><span class="line"></span><br><span class="line">datetime_taipei_dt = datetime_dt.astimezone(pytz.timezone(&apos;Asia/Tokyo&apos;)) # UTC+9</span><br><span class="line"></span><br><span class="line">print(datetime_taipei_dt)       # 2018-08-24 22:35:46.694889+09:00</span><br></pre></td></tr></table></figure>
<p>Because my PC is located in UTC+8 timezone, the content of <code>datetime_dt</code> represents the time of UTC+8 timezone. Tokyo is located in UTC+9 timezone. That’s why there’s a 1 hour difference between <code>datetime_dt</code> and <code>datetime_taipei_dt</code>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2018/06/16/AWS CLI 切換不同配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/16/AWS CLI 切換不同配置/" class="post-title-link" itemprop="url">AWS CLI 切換不同配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2018-06-16 14:54:00" itemprop="dateCreated datePublished" datetime="2018-06-16T14:54:00+08:00">2018-06-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>AWS CLI(command line interface) 的使用過程中，可能需要在不同的配置之間做切換，例如從 production 轉換到 development 環境。在 <code>~/.aws/config</code> 與 <code>~/.aws/credentials</code> <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" target="_blank" rel="noopener">設定好</a>後，基本的切換方式包含</p>
<ol>
<li><p>在 AWS CLI 後面加上 <code>--profile user1</code> 即可使用 <code>user1</code> profile。<br>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ aws s3 ls --profile user1</span><br><span class="line">2018-06-11 20:45:20 test-bucket</span><br></pre></td></tr></table></figure>
</li>
<li><p>設定 <code>AWS_DEFAULT_PROFILE</code>，例如 <code>export AWS_DEFAULT_PROFILE=user_name</code>。設定好了 AWS CLI 就會使用該帳號。</p>
</li>
</ol>
<p>上述方法切換前，都需要改動 <a href="https://superuser.com/questions/426114/understanding-bashrc-and-bash-profile" target="_blank" rel="noopener">Bash Profile</a>，實在不方便，底下有較便捷的方式:</p>
<ol>
<li><p><strong>使用 alias</strong>:</p>
<p>例如設定 <code>alias aws1=&#39;aws --profile user1&#39;</code> 與 <code>alis aws2=&#39;aws --profile user2&#39;</code>，這樣一來，以後輸入 <code>aws1 s3 ls</code> 就會看到 <code>user1</code> 的 s3 bucket，<code>aws2 s3 ls</code> 會看到 <code>user2</code> 的。</p>
</li>
<li><p><strong>改用 <a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener">oh-my-zsh</a> 並搭配 <a href="https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins#aws" target="_blank" rel="noopener">AWS plugin</a></strong></p>
<p>裝好後可以用 <code>asp</code> 與 <code>agp</code> 來切換與顯示 AWS CLI 配置。</p>
</li>
</ol>
<p>參考資料: </p>
<ul>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" target="_blank" rel="noopener">AWS CLI Getting Started</a></li>
<li><a href="https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins#aws" target="_blank" rel="noopener">oh-my-zsh plugin#aws</a></li>
<li><a href="https://stackoverflow.com/questions/593334/how-to-use-multiple-aws-accounts-from-the-command-line" target="_blank" rel="noopener">How to use multiple AWS Accounts from the command line?
</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lyenliang.github.io/2017/12/17/node-js-Limiting-the-number-of-parallel-promises/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyenliang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Brian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/17/node-js-Limiting-the-number-of-parallel-promises/" class="post-title-link" itemprop="url">[node.js] Limiting the number of parallel promises</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2017-12-17 19:56:00" itemprop="dateCreated datePublished" datetime="2017-12-17T19:56:00+08:00">2017-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-06-17 10:30:04" itemprop="dateModified" datetime="2022-06-17T10:30:04+08:00">2022-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="http://bluebirdjs.com/docs/api/promise.all.html" target="_blank" rel="noopener">Promise.all</a> is a useful funciton when you want to wait for more than 1 promise running in parallel to complete. However, sometimes you may want to limit the number of parallel promises. For example, you may wish to limit the number of simultaneous downloads from a website.</p>
<p><a href="https://github.com/charto/cwait" target="_blank" rel="noopener">cwait</a> is a convenient tool which allows you to limit the number of promises running in parallel. </p>
<p>Here I’ll demonstrate how to use <code>cwait</code>. First let’s assume we have a function <code>later</code> that returns a promise which is resolved after a specified timeout. </p>
<pre><code>function later (time, val) {
  console.log(`later is triggered. ${val}`)
  return new Promise((resolve, reject) =&gt; {
    setTimeout(resolve, time, val)
  })
}
</code></pre><p>When we create 10 promises with <code>later</code>, and execute them with <code>Promise.all</code>, it will take about 1 second to finish the execution.</p>
<pre><code>// echoNumberPromiseAll.js

const Promise = require(&apos;bluebird&apos;)

let totalNumber = 10
let timeout = 1000 // 1000 ms
let start, finish

function later (time, val) {
  console.log(`later triggered. ${val}`)
  return new Promise((resolve, reject) =&gt; {
    setTimeout(resolve, time, val)
  })
}

let promises = []
function init () {
  start = new Date()
  for (let i = 0; i &lt; totalNumber; i += 1) {
    promises.push(later(timeout, i))
  }
}

init()

Promise.all(promises)
  .then((result) =&gt; {
    console.log(`All done. result: ${result}`)
    finish = new Date()
    console.log(`Execution time: ${finish - start} ms`)
  })
  .catch(err =&gt; {
    console.error(`error: ${err}`)
  })
</code></pre><p><code>node echoNumberPromiseAll.js</code>‘s execution result:</p>
<pre><code>node echoNumberPromiseAll.js
later triggered. 0
later triggered. 1
later triggered. 2
later triggered. 3
later triggered. 4
later triggered. 5
later triggered. 6
later triggered. 7
later triggered. 8
later triggered. 9
All done. result: 0,1,2,3,4,5,6,7,8,9
Execution time: 1012 ms
</code></pre><p>As you can see from the above output, 10 promises are triggered simultaneously. Because the execution time is about 1 second.</p>
<p>Before we can apply <code>cwait</code>, we have to convert <code>Promise.all</code> to <a href="http://bluebirdjs.com/docs/api/promise.map.html" target="_blank" rel="noopener"><code>Promise.map</code></a> first. </p>
<p>Here’s the converted code:</p>
<pre><code>// echoNumberPromiseMap.js

const Promise = require(&apos;bluebird&apos;)

let totalNumber = 10
let timeout = 1000 // 1000 ms
let start, finish

let numbers = []

function later (time, val) {
  console.log(`later triggered. ${val}`)
  return new Promise((resolve, reject) =&gt; {
    setTimeout(resolve, time, val)
  })
}

function init () {
  start = new Date()
  for (let i = 0; i &lt; totalNumber; i += 1) {
    numbers.push(i)
  }
}

function promiseMap (number) {
  return later(timeout, number)
}

init()

Promise.map(numbers, promiseMap)
  .then((result) =&gt; {
    console.log(`All done. result: ${result}`)
    finish = new Date()
    console.log(`Execution time: ${finish - start} ms`)
  })
  .catch(err =&gt; {
    console.error(`error: ${err}`)
  })
</code></pre><p>Then we will be able to apply <code>cwait</code> to the above code:</p>
<pre><code>// echoNumberCwait.js

const TaskQueue = require(&apos;cwait&apos;).TaskQueue
const Promise = require(&apos;bluebird&apos;)

let queue = new TaskQueue(Promise, 3)

let totalNumber = 10
let timeout = 1000 // 1000 ms
let start, finish

let numbers = []

function later (time, val) {
  console.log(`later triggered. ${val}`)
  return new Promise((resolve, reject) =&gt; {
    setTimeout(resolve, time, val)
  })
}

function init () {
  start = new Date()
  for (let i = 0; i &lt; totalNumber; i += 1) {
    numbers.push(i)
  }
}

function promiseMap (number) {
  return later(timeout, number)
}

init()

Promise.map(numbers, queue.wrap(promiseMap))
  .then((result) =&gt; {
    console.log(`All done. result: ${result}`)
    finish = new Date()
    console.log(`Execution time: ${finish - start}`)
  })
  .catch(err =&gt; {
    console.error(`error: ${err}`)
  })
</code></pre><p>In the example above, we limit the number of parallel promises to 3. Here’s the execution result of <code>node echoNumberCwait.js</code></p>
<pre><code>later triggered. 0
later triggered. 1
later triggered. 2
later triggered. 3
later triggered. 9
later triggered. 8
later triggered. 7
later triggered. 6
later triggered. 5
later triggered. 4
All done. result: 0,1,2,3,4,5,6,7,8,9
Execution time: 4016 ms
</code></pre><p>The program first executes the promises with <code>val</code> equal to 0, 1, and 2. And waits until the 3 promises are completed. Then it executes the promises with <code>val</code> equal to 3, 9, and 8. and wait for them to complete …</p>
<p>So in the end, it takes about 4 seconds to finish the execution. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一頁"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lyenliang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">標籤</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lyenliang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
